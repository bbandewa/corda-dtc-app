<!DOCTYPE HTML>
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
    <META content="IE=11.0000"
          http-equiv="X-UA-Compatible">
    <TITLE> </TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8"><!-- jQuery -->

    <SCRIPT src="js/jquery-1.10.1.min.js"></SCRIPT>

    <SCRIPT src="js/jquery-migrate-1.2.1.min.js"></SCRIPT>

    <SCRIPT src="js/jquery-ui.js"></SCRIPT>

    <SCRIPT src="js/grid.locale-en.js"></SCRIPT>

    <SCRIPT src="js/jquery.jqGrid.min.js"></SCRIPT>
    <!-- jquery-ui CSS -->
    <LINK href="css/jquery-ui.css"
          rel="stylesheet">     <!-- Bootstrap core CSS -->
    <LINK href="css/bootstrap.min.css"
          rel="stylesheet">
    <LINK href="css/ui.jqgrid.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <STYLE type="text/css">
        body {
            padding-top: 30px;
            padding-bottom: 40px;
        }

        #content {
            width: 100%;
            height: 100%;
        }

        .navbar {
            margin-bottom: 30px;
        }

        .jumbotron {
            font-size: inheret;
            font-weight: 200;
            line-height: 1;
            color: inherit;
        }
    </STYLE>
    <LINK href="css/jqGrid.bootstrap.css" rel="stylesheet">
    <LINK href="css/Custom.css" rel="stylesheet">
    <SCRIPT src="js/custom.js"></SCRIPT>

    <META name="GENERATOR" content="MSHTML 11.00.10570.1001">
</HEAD>
<BODY>
    <FORM id="form1" method="post">
        <div class="websiteHeader" id="divWebHeader">
            <div class="row">
                <div class="col-md-1"><img src="images/KBCIcon.png" height="35" style="border:solid 1px white;margin-top:7px;margin-left:10px; " /></div>
                <div class="col-md-3"><h3 style="margin-bottom:0px; margin-top:10px;margin-left:20px;">Digital Trade Chain</h3></div>
                <div class="col-md-8">
                    <div class="pull-right" style="text-align:right; margin-bottom:0px; margin-top:10px;margin-right:100px;font-size:15px;">
                        <div class="dropdown">
                            <a href="#" id="lnkUsersettings" data-toggle="dropdown" class="dropdown-toggle" style="color:white !important;">
                                <img src="images/userImage.png" height="35" class="img-circle" /> &nbsp;&nbsp;<span id="lblBankTitle"></span> &nbsp; <span class="glyphicon glyphicon-triangle-bottom"></span>
                            </a>
                            <div class="dropdown-menu" style="min-width:200px;background-color:#f5f5f5; padding:10px;">
                                <div class="row marginBottom10">
                                    <div class="col-md-12" style="margin-bottom:7px;">
                                        <a>  My Profile</a>
                                    </div>
                                </div>
                                <div class="row" style="margin-bottom:7px;">
                                    <div class="col-md-12">
                                        <a href="#">Change Password</a>
                                    </div>
                                </div>
                                <div class="row" style="margin-bottom:7px;">
                                    <div class="col-md-12">
                                        <a href="#">Logout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="busyStatus" id="divBusyStatus" style="text-align: center;">
            <div id="yourdiv" style="display: inline-block;">
                <div class="loader">
                </div>
            </div>
            <h2>Please wait...</h2>
        </div>
        <DIV class="panel-heading" style="width: 100%; height: 50px; color: white; margin-bottom: 5px;"></DIV>

        <DIV class="container">
            <DIV id="content">

                <DIV class="panel-group" id="divPanleMain">
                    <DIV class="panel panel-info" id="divSearchBuyerCointainer">
                        <DIV class="panel-heading">
                            <H4 class="modal-title" id="h4BuyerSeller">I am a buyer</H4>
                            &nbsp; &nbsp;                    <BUTTON class="btn btn-info"
                                                                     id="btnBuyer">
                                Buyer
                            </BUTTON>&nbsp;                    <BUTTON class="btn btn-info"
                                                                       id="btnSeller">
                                Seller
                            </BUTTON>
                        </DIV>
                        <DIV class="panel-body">
                            <DIV class="form-group">
                                <DIV class="row">
                                    <DIV class="col-sm-8">
                                        <DIV class="col-sm-6"
                                             style="padding-right: 1px;"><INPUT class="form-control" id="txtSearchBuyer" disabled="disabled" style="height: 28px !important; line-height: 28px;" type="text" placeholder="Search buyer" value=""></DIV>
                                        <DIV class="col-sm-2" style="padding-left: 1px;">
                                            <BUTTON class="btn btn-default"
                                                    id="btnSearchBuyer" type="button" data-toggle="modal"
                                                    data-target="#myModal">
                                                <SPAN class="glyphicon glyphicon-search"></SPAN>
                                            </BUTTON>
                                        </DIV>
                                    </DIV>
                                </DIV>
                            </DIV>
                        </DIV><!-- Modal -->

                        <DIV class="modal fade" id="myModal" role="dialog">
                            <DIV class="modal-dialog">
                                <!-- Modal content-->
                                <DIV class="modal-content">
                                    <DIV class="modal-header">
                                        <BUTTON class="close" type="button" data-dismiss="modal"></BUTTON>
                                        <H4 class="modal-title">Select Party</H4>
                                    </DIV>
                                    <DIV class="modal-body">
                                        <TABLE id="jqGridBuyer"></TABLE>
                                        <DIV id="jqGridBuyerPager"></DIV>
                                    </DIV>
                                    <DIV class="modal-footer">
                                        <BUTTON class="btn btn-default" type="button"
                                                data-dismiss="modal">
                                            Close
                                        </BUTTON>
                                    </DIV>
                                </DIV>
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV class="panel panel-info" id="divBankDetailsContainer">
                        <DIV class="panel-heading">
                            Bank Details
                        </DIV>
                        <DIV class="panel-body">
                            <TABLE class="table table-hover">
                                <THEAD>
                                    <TR>
                                        <TH>Company</TH>
                                        <TH>Bank</TH>
                                        <TH>VAT</TH>
                                        <TH>IBAN</TH>
                                        <TH>Address</TH>
                                    </TR>
                                </THEAD>
                                <TBODY>
                                    <TR>
                                        <TD><LABEL id="lblCompany"></LABEL>                                 </TD>
                                        <TD><LABEL id="lblBank"></LABEL>                                 </TD>
                                        <TD><LABEL id="lblVAT"></LABEL>                                 </TD>
                                        <TD><LABEL id="lblIBAN"></LABEL>                                 </TD>
                                        <TD>
                                            <LABEL id="lblAddress"></LABEL>
                                        </TD>
                                    </TR>
                                </TBODY>
                            </TABLE>
                        </DIV>
                    </DIV>
                    <DIV class="panel">
                        <DIV class="row">
                            <DIV class="col-sm-6">
                                <DIV class="panel panel-info" id="divOrderDetailsContainer">
                                    <DIV class="panel-heading">
                                        Order Details
                                    </DIV>
                                    <DIV class="panel-body">
                                        <DIV class="row">
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtPurchaseOrder">Purchase Order:</LABEL>

                                                    <INPUT class="form-control input-sm" id="txtPurchaseOrder" type="text">
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtTotalPrice">Total Price:</LABEL>
                                                    <INPUT class="form-control" disabled="disabled" id="txtTotalPrice" type="text">
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="ddlCurrency">Currency</LABEL>

                                                    <SELECT class="form-control" id="ddlCurrency">
                                                        <OPTION>-- Select --</OPTION>
                                                        <OPTION>USD ($)</OPTION>
                                                        <OPTION>EUR (€)</OPTION>
                                                        <OPTION>JPY (¥)</OPTION>
                                                        <OPTION>GBP (£)</OPTION>
                                                        <OPTION>AUD ($)</OPTION>
                                                        <OPTION>CAD ($)</OPTION>
                                                        <OPTION>CHF (Fr)</OPTION>
                                                        <OPTION>CNY (¥)</OPTION>
                                                        <OPTION>SEK (kr)</OPTION>
                                                        <OPTION>MXN ($)</OPTION>
                                                        <OPTION>NZD ($)</OPTION>
                                                        <OPTION>SGD ($)</OPTION>
                                                        <OPTION>HKD ($)</OPTION>
                                                        <OPTION>NOK (kr)</OPTION>
                                                        <OPTION>KRW (₩)</OPTION>
                                                        <OPTION>TRY (₺)</OPTION>
                                                        <OPTION>INR (₹)</OPTION>
                                                        <OPTION>RUB (₽)</OPTION>
                                                        <OPTION>BRL (R$)</OPTION>
                                                        <OPTION>ZAR (R)</OPTION>
                                                    </SELECT>
                                                    <!--<INPUT class="form-control" id="txtCurrency" type="text">-->
                                                </DIV>
                                            </DIV>
                                        </DIV>
                                        <DIV class="row">
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtDeliveryDate">Delivery Date:</LABEL>
                                                    <INPUT class="form-control" id="txtDeliveryDate" type="text">
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtIncoterm">Incoterm:</LABEL>
                                                    <INPUT class="form-control" id="txtIncoterm" type="text">
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtPaymentCondition">
                                                        Payment
                                                        Condition:
                                                    </LABEL>                                             <INPUT class="form-control" id="txtPaymentCondition" type="text">
                                                </DIV>
                                            </DIV>
                                        </DIV>
                                    </DIV>
                                </DIV>
                            </DIV>
                            <DIV class="col-sm-6">
                                <DIV class="panel panel-info" id="divArticleDetailsContainer" style="min-height: 134px;">
                                    <DIV class="panel-heading">
                                        Article Details
                                        <A class="pull-right" id="lnkAddItem" href="#">
                                            <b>Add</b>
                                        </A>
                                    </DIV>
                                    <DIV class="panel-body">
                                        <TABLE class="table" id="tblArticleDetails">
                                            <THEAD>
                                                <TR>
                                                    <TH>ArticleID</TH>
                                                    <TH>Description</TH>
                                                    <TH>Quantity</TH>
                                                </TR>
                                            </THEAD>
                                            <TBODY id="tblArticleDetailsBody">
                                                <TR id="trArticle1">
                                                    <TD>
                                                        <DIV class="form-group">
                                                            <SELECT class="ddlDummySelector" id="ddlItemID"
                                                                    style="width: 80px;">
                                                                <OPTION>-- Select --</OPTION>
                                                                <OPTION>Kingfisher</OPTION>
                                                                <OPTION>Magnum</OPTION>
                                                                <OPTION>Bacardi</OPTION>
                                                                <OPTION>Tuborg</OPTION>
                                                            </SELECT>
                                                        </DIV>
                                                    </TD>
                                                    <TD>
                                                        <DIV class="col-sm-4"><INPUT class="form-control" id="txtItemDescription" style="min-width: 280px;" type="text"></DIV>
                                                    </TD>
                                                    <TD>
                                                        <DIV class="form-group col-sm-6"><INPUT class="form-control" id="txtItemQuantity" onblur="javascript:updateTotalPrice();" type="text"></DIV>
                                                    </TD>
                                                </TR>
                                            </TBODY>
                                        </TABLE>
                                    </DIV>
                                </DIV>
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV class="panel">
                        <DIV class="row">
                            <DIV class="col-sm-6">
                                <DIV class="panel panel-info" id="divDeliveryAddressContainer">
                                    <DIV class="panel-heading">
                                        Delivery Address
                                    </DIV>
                                    <DIV class="panel-body">
                                        <DIV class="row">
                                            <DIV class="col-sm-12">
                                                <DIV class="form-group">
                                                    <LABEL for="txtAddress">Address:</LABEL>
                                                    <INPUT class="form-control" id="txtAddress" type="text">
                                                </DIV>
                                            </DIV>
                                            <!--<DIV class="col-sm-6">
                                                <DIV class="form-group">
                                                    <LABEL for="txtAddress2">Address2:</LABEL>
                                                    <INPUT class="form-control" id="txtAddress2" type="text">
                                                </DIV>
                                            </DIV>-->
                                        </DIV>
                                        <DIV class="row">
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtPostalCode">Postal Code:</LABEL>
                                                    <INPUT class="form-control" id="txtPostalCode" type="text">
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtCity">City:</LABEL>

                                                    <INPUT class="form-control" id="txtCity" type="text">
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-4">
                                                <DIV class="form-group">
                                                    <LABEL for="txtCountry">Country:</LABEL>
                                                    <INPUT class="form-control" id="txtCountry" type="text">
                                                </DIV>
                                            </DIV>
                                        </DIV>
                                    </DIV>
                                </DIV>
                            </DIV>
                            <DIV class="col-sm-6">
                                <DIV class="panel panel-info" id="divExtraServicesContainer" style="min-height: 134px;">
                                    <DIV class="panel-heading">
                                        Extra Services
                                    </DIV>
                                    <DIV class="panel-body">
                                        <DIV class="row">
                                            <DIV class="col-sm-6" id="divBuyerExtraServices">
                                                <DIV class="form-group">
                                                    <LABEL>Buyer:</LABEL>

                                                    <DIV class="checkbox">
                                                        <LABEL>
                                                            <INPUT id="chkPaymentConfirmation" type="checkbox"
                                                                   value="">Payment Confirmation
                                                        </LABEL>
                                                    </DIV>
                                                    <DIV class="checkbox">
                                                        <LABEL>
                                                            <INPUT id="chkBankPaymentCommitment" type="checkbox"
                                                                   value="">Bank Payment Commitment
                                                        </LABEL>
                                                    </DIV>
                                                </DIV>
                                            </DIV>
                                            <DIV class="col-sm-6">
                                                <DIV class="form-group" id="divSellerExtraServices">
                                                    <LABEL>Seller:</LABEL>

                                                    <DIV class="checkbox">
                                                        <LABEL>
                                                            <INPUT id="chkInformationCounterparty" type="checkbox"
                                                                   value="">Information Counterparty
                                                        </LABEL>
                                                    </DIV>
                                                    <DIV class="checkbox">
                                                        <LABEL>
                                                            <INPUT id="chkForfaitingOfInvoice" type="checkbox"
                                                                   value="">Forfaiting Of Invoice
                                                        </LABEL>
                                                    </DIV>
                                                </DIV>
                                            </DIV>
                                        </DIV>
                                    </DIV>
                                </DIV>
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV class="panel " id="divSaveOrder">
                        <DIV class="row pull-right">
                            <DIV class="col-sm-5">
                                <BUTTON class="btn btn-info " id="btnSave">Save</BUTTON>
                            </DIV>
                            <DIV class="col-sm-5">
                                <BUTTON class="btn btn-info" id="btnClose">Close</BUTTON>
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV class="panel panel-info" id="divOrderStatus">
                        <DIV class="panel-body">
                            <DIV class="form-group">
                                <DIV class="row">
                                    <DIV class="col-sm-3">
                                        <LABEL>Invoice Status:</LABEL>

                                        <H4>
                                            <SPAN class="label label-default" id="spanInvoiceStatus">
                                                Not
                                                Sent
                                            </SPAN>
                                        </H4>
                                    </DIV>
                                    <DIV class="col-sm-3">
                                        <LABEL for="email">Payment Status:</LABEL>

                                        <H4>
                                            <SPAN class="label label-primary" id="spanPaymentStatus">
                                                Primary
                                                Label
                                            </SPAN>
                                        </H4>
                                    </DIV>
                                    <DIV class="col-sm-3">
                                        <LABEL for="email">Contract Status:</LABEL>

                                        <H4>
                                            <SPAN class="label label-success" id="spanContractStatus">
                                                Success
                                                Label
                                            </SPAN>
                                        </H4>
                                    </DIV>
                                    <DIV class="col-sm-3">
                                        <LABEL for="email">Delivery Status:</LABEL>

                                        <H4>
                                            <SPAN class="label label-info" id="spanDeliveryStatus">Info Label</SPAN>
                                        </H4>
                                    </DIV>
                                </DIV>
                            </DIV>
                            <DIV class="form-group">
                                <DIV class="row">
                                    <DIV class="col-sm-4">
                                        <LABEL for="email">Tracking ID :</LABEL>

                                        <H4>
                                            <SPAN class="label label-warning" id="spanTrackingID">
                                                Warning
                                                Label
                                            </SPAN>
                                        </H4>
                                    </DIV>
                                </DIV>
                            </DIV>
                        </DIV>
                    </DIV>
                    <DIV class="panel" id="divOrderConfirmation">
                        <DIV class="row pull-right">
                            <DIV class="col-sm-3">
                                <BUTTON class="btn btn-info" id="btnBack">
                                    Back
                                </BUTTON>
                            </DIV>
                            <DIV class="col-sm-3">
                                <BUTTON class="btn btn-info" id="btnConfirmOrder">
                                    Confirm
                                    Order
                                </BUTTON>
                            </DIV>
                            <DIV class="col-sm-3">
                                <BUTTON class="btn btn-info" id="btnDeclineOrder">
                                    Decline
                                    Order
                                </BUTTON>
                            </DIV>
                            <DIV class="col-sm-3">
                                <BUTTON class="btn btn-info" id="btnSendInvoice">
                                    Send
                                    Invoice
                                </BUTTON>
                            </DIV>
                        </DIV>
                    </DIV>
                </DIV>
            </DIV>
            <SCRIPT type="text/javascript">
                var currentParty = null;
                var formAction = null;
                var orderDetails = null;
                //var userID = "abc123";
                var userID = getQueryStringValue("userID");
                $(document).ready(function () {
                    setBankTitle("lblBankTitle");
                    jqGridBuyer = $("#jqGridBuyer");
                    jqGridBuyer.jqGrid({
                        colNames: ['ID', 'Name'],
                        colModel: [
                            { name: 'id', index: 'ID', width: "110" },
                            { name: 'name', index: 'Name', width: "425" }
                        ],
                        pager: '#jqGridBuyerPager',
                        datatype: "local",
                        data: data.rows,
                        viewrecords: true,
                        shrinkToFit: true,
                        height: "auto",
                        ignoreCase: true,
                        onSelectRow: function (id) {
                            var jqGridBuyer = $('#jqGridBuyer');
                            var selRowId = jqGridBuyer.jqGrid('getGridParam', 'selrow');
                            var celValue = jqGridBuyer.jqGrid('getCell', selRowId, 'id');
                            $("#txtSearchBuyer").val(jqGridBuyer.jqGrid('getCell', selRowId, 'name'));
                            $('#myModal').modal('hide');
                            var bankDetails = getPartyBankDetails(celValue);
                            if (null != bankDetails && undefined != bankDetails) {
                                $("#lblCompany").text(bankDetails.company);
                                $("#lblBank").text(bankDetails.bankName);
                                $("#lblVAT").text(bankDetails.vat);
                                $("#lblIBAN").text(bankDetails.iban);
                                $("#lblAddress").text(bankDetails.address);
                            }
                        }
                    });
                    jqGridBuyer.jqGrid('navGrid', '#jqGridBuyerPager', { add: false, edit: false, del: false }, {}, {}, {});
                    /*
                    $("#jqGridBuyer").jqGrid({
                        datatype: "local",//http://stackoverflow.com/questions/6831306/load-local-json-data-in-jqgrid-without-addjsonrows
                        // url: "ChainGangService.asmx/GetData",
                        //mtype: "POST",
                        //ajaxGridOptions: { contentType: 'application/json; charset=utf-8' },
                        //serializeGridData: function (postData) {
                        //    return JSON.stringify(postData);
                        //},
                        //jsonReader: { repeatitems: false, root: "d.orders", page: "d.page", total: "d.total", records: "d.records" },
                        datatype: "json",
                        height: "auto",
                        rowNum: 10,
                        shrinkToFit: true,
                        rowList: [10, 20, 30],
                        colNames: ['id', 'Party', 'Order Date'],
                        colModel: [
                        { name: 'id', hidden: true },
                        { name: 'name', width: 400, sortable: false, align: "center", hidden: false },
                        { name: 'orderDate', width: 100, sortable: false, align: "center", hidden: false }
                        ],
                        pager: "#jqGridBuyerPager",
                        viewrecords: true,
                        caption: "Buyer List",
                        hidegrid: false,
                        onSelectRow: function (id) {
                            var jqGridBuyer = $('#jqGridBuyer');
                            var selRowId = jqGridBuyer.jqGrid('getGridParam', 'selrow');
                            var celValue = jqGridBuyer.jqGrid('getCell', selRowId, 'name');
                            $("#txtSearchBuyer").val(celValue);
                            $('#myModal').modal('hide');
                            setBankDetails(celValue);
                        }
                    });
                    // Setup buttons
                    $("#jqGridBuyer").jqGrid('navGrid', '#jqGridBuyerPager',
                            { edit: false, add: false, del: false, search: true },
                            { reloadAfterSubmit: true }
                    );
                    */
                    function setBankDetails(partyName) {
                        if (undefined == partyName || partyName == '' || partyName == null) {
                            // TODO: Get bank details of buyer/seller  in case of new order.

                            //$("#lblCompany").text("DTC Corp");
                            //$("#lblBank").text("Bank of Scotland");
                            //$("#lblVAT").text("BOS12SB8EGHAS");
                            //$("#lblIBAN").text("BOS12SB");
                            ////$("#lblAddress").text("45 Henderson St, Bridge of Allan, Stirling FK9 4HG, UK");

                        }
                        else {
                            debugger;
                            $("#lblCompany").text(orderDetails.buyer.name); // TODO :
                            $("#lblBank").text(orderDetails.buyer.bankName);
                            $("#lblVAT").text(orderDetails.buyer.vat);
                            $("#lblIBAN").text(orderDetails.buyer.iban);
                            $("#lblAddress").text("45 Henderson St, Bridge of Allan, Stirling FK9 4HG, UK");
                        }
                    }
                    function setBankTitle(label) {
                        $("#" + label).text("Welcome Guest !");
                        var newAccount = new Object();
                        //var serviceURL = window.location.protocol + "//" + window.location.host + "/api/dtc/me";
                        $.ajax({
                            type: "GET",
                            url: serviceURL + "me",
                            dataType: "json",
                            contentType: "application/json;charset=UTF-8",
                            data: newAccount, //objOrder will be parameter name in service.
                            success: function (data) {
                                var currentSite = data.me;
                                var currentUsername = "Guest";
                                if (null != currentUser && undefined != currentUser && null != currentUser.userName && undefined != currentUser.userName) {
                                    currentUsername = currentUser.userName;
                                }
                                $("#" + label).text("Welcome to " + currentSite + " " + currentUsername + " !");
                            },
                            error: function (errMsg) {
                                alert(errMsg);
                                //redirectUser("OrderList.htm?userID=" + userID);
                                //window.location = "OrderList.htm?userID=" + userID;
                            }
                        });
                    }
                    function setOrderDetails() {
                        debugger;
                        $("#txtPurchaseOrder").val(orderDetails.purchaseOrderNum);
                        $("#txtTotalPrice").val(orderDetails.totalPrice);

                        $("#ddlCurrency option:contains(" + orderDetails.currency + ")").attr('selected', 'selected');
                        //$("#txtCurrency").val(orderDetails.currency);
                        $('#txtDeliveryDate').datepicker("setDate", orderDetails.deliveryDate);
                        //$("#txtDeliveryDate").val(orderDetails.deliveryDate);
                        $("#txtIncoterm").val(orderDetails.incoterm);
                        $("#txtPaymentCondition").val(orderDetails.pymntCondDays);
                        $("#divOrderDetailsContainer input[type='text']").attr("disabled", "disabled");

                        //setArticleDetails
                        var tableRow = "";
                        for (var i = 0; i < orderDetails.itemsList.length; i++) {
                            var item = orderDetails.itemsList[i];
                            tableRow += "<tr> <td>" + item.article.articleId + "</td> <td>" + item.article.description + "</td> <td>" + item.quantity + "</td> </tr>";
                        }
                        $('#tblArticleDetailsBody').html(tableRow);

                        // setOrderAddress
                        $("#txtAddress").val(orderDetails.deliveryAddress.streetName);
                        //$("#txtAddress2").val(orderDetails.deliveryAddress.streetNumber);
                        $("#txtPostalCode").val(orderDetails.deliveryAddress.postalCode);
                        $("#txtCity").val(orderDetails.deliveryAddress.city);
                        $("#txtCountry").val(orderDetails.deliveryAddress.country);
                        debugger;
                        // setOrderExtraServices
                        $("#chkPaymentConfirmation").prop("checked", orderDetails.pymntConfirmation);
                        $("#chkBankPaymentCommitment").prop("checked", orderDetails.bankPymntCommitment);
                        $("#chkInformationCounterparty").prop("checked", orderDetails.infoCounterparty);
                        $("#chkForfaitingOfInvoice").prop("checked", orderDetails.forfaitingOfInvoice);


                        // setOrderStatus
                        $("#spanInvoiceStatus").text("spanInvoiceStatus");
                        $("#spanPaymentStatus").text();
                        $("#spanContractStatus").text();
                        $("#spanInvoiceStatus").text();
                        $("#spanDeliveryStatus").text();
                        $("#spanTrackingID").text();
                    }
                    function setControlByAction() {
                        $("#divOrderConfirmation").hide();
                        $("#divOrderStatus").hide();
                        $("#divSaveOrder").hide();

                        if (formAction == action.create) {
                            $("#divSaveOrder").show();
                        }
                        else if (formAction == action.edit) {
                            $("#divOrderConfirmation").show();
                            $("#divOrderStatus").show();
                        }
                        else if (formAction == action.view) {

                            $("#fieldName").prop("readonly", true);

                            $("#divOrderStatus").show();
                        }
                    }
                    function setBuyerSeller(buyerseller) {
                        $("#txtSearchBuyer").val(buyerseller);
                    }
                    function loadOrderDetails(orderID) {
                        orderDetails =
                        {
                            buyer: {
                                name: "ABC",
                                userName: "abc123",
                                address: {
                                    streetName: "Shafer Courte",
                                    streetNumber: "1200",
                                    postalCode: "41006",
                                    city: "London",
                                    country: "UK"
                                },
                                bankName: "HDFC",
                                vat: "0215589963",
                                iban: "FR124545"
                            },
                            seller: {
                                name: "XYZ",
                                userName: "xyz456",
                                address: {
                                    streetName: "Shafer Courte1",
                                    streetNumber: "1201",
                                    postalCode: "41007",
                                    city: "Zurich",
                                    country: "UK"
                                },
                                bankName: "HDFC",
                                vat: "0215589964",
                                iban: "FR124546"
                            },
                            purchaseOrderNum: "111",
                            deliveryDate: "2018-09-15",
                            pymntCondDays: 60,
                            deliveryAddress: {
                                streetName: "Karve Road",
                                streetNumber: "605",
                                postalCode: "411038",
                                city: "Pune",
                                country: "UK"
                            },
                            itemsList: [
                              {
                                  article: {
                                      articleId: "widget",
                                      description: "widget",
                                      price: "3"
                                  },
                                  quantity: "0"
                              },
                              {
                                  article: {
                                      articleId: "thing",
                                      description: "thing",
                                      price: "4"
                                  },
                                  quantity: "0"
                              }
                            ],
                            pymntConfirmation: false,
                            bankPymntCommitment: false,
                            infoCounterparty: false,
                            forfaitingOfInvoice: false,
                            incoterm: "",
                            totalPrice: "0",
                            currency: "EUR"
                        };

                        if (!(null == orderID || undefined == orderID || orderID == '' || orderID == '0')) {

                            $.ajax({
                                type: "GET",
                                url: "http://localhost:10005/api/dtc/" + orderID + "/get-po-details",
                                dataType: 'json',
                                async: false,
                                //contentType: "application/json; charset=utf-8",
                                //data: JSON.stringify(order), //objOrder will be parameter name in service.
                                beforeSend: function () {
                                    $("#divBusyStatus").show();
                                },
                                complete: function () {
                                    $("#divBusyStatus").hide();
                                },
                                success: function (data) {
                                    debugger;
                                    orderDetails = data[0];
                                },
                                error: function (errMsg) {
                                    alert("Error");
                                    alert(errMsg);
                                    debugger;

                                }
                            });

                        }
                        /* orderDetails =
                               {
                                   buyer: {
                                       name: "ABC",
                                       userName: "abc123",
                                       address: {
                                           streetName: "Shafer Courte",
                                           streetNumber: "1200",
                                           postalCode: "41006",
                                           city: "London",
                                           country: "UK"
                                       },
                                       bankName: "HDFC",
                                       vat: "0215589963",
                                       iban: "FR124545"
                                   },
                                   seller: {
                                       name: "XYZ",
                                       userName: "xyz456",
                                       address: {
                                           streetName: "Shafer Courte1",
                                           streetNumber: "1201",
                                           postalCode: "41007",
                                           city: "Zurich",
                                           country: "UK"
                                       },
                                       bankName: "HDFC",
                                       vat: "0215589964",
                                       iban: "FR124546"
                                   },
                                   purchaseOrderNum: "111",
                                   deliveryDate: "2018-09-15",
                                   pymntCondDays: 60,
                                   deliveryAddress: {
                                       streetName: "Karve Road",
                                       streetNumber: "605",
                                       postalCode: "411038",
                                       city: "Pune",
                                       country: "UK"
                                   },
                                   itemsList: [
                                     {
                                         article: {
                                             articleId: "widget",
                                             description: "widget",
                                             price: "3"
                                         },
                                         quantity: "0"
                                     },
                                     {
                                         article: {
                                             articleId: "thing",
                                             description: "thing",
                                             price: "4"
                                         },
                                         quantity: "0"
                                     }
                                   ],
                                   pymntConfirmation: false,
                                   bankPymntCommitment: false,
                                   infoCounterparty: false,
                                   forfaitingOfInvoice: false,
                                   incoterm: "",
                                   totalPrice: "0",
                                   currency: "EUR"
                               }; */
                    }
                    function initForm() {
                        var orderID = getQueryStringValue("orderID");
                        if (null == orderID || undefined == orderID || orderID == '' || orderID == '0') {
                            formAction = action.create;
                            loadOrderDetails(0);
                            $("#txtPurchaseOrder").val(getPurchaseOrderNumber());
                            $("#txtPurchaseOrder").attr("disabled", "disabled");
                            setControlByAction();
                            setBankDetails('');
                        }
                        else {
                            formAction = action.edit;
                            $("#divSearchBuyerCointainer").hide();
                            loadOrderDetails(orderID);
                            debugger;
                            setControlByAction();
                            debugger;
                            setBankDetails(orderDetails.buyer.name);//pass party id and bind bank details.
                            setOrderDetails();
                        }
                    }
                    initForm();
                    $("#txtDeliveryDate").datepicker({
                        dateFormat: 'yy-mm-dd',
                        minDate: new Date()
                    });
                    $("#lnkAddItem").click(function () {
                        var latestTR = $("#tblArticleDetails tr:last").clone();
                        latestTR.find("select").prop('selectedIndex', 0);
                        latestTR.find("input[type='text']").val('');
                        latestTR.appendTo("#tblArticleDetails");
                        updateTotalPrice();
                    });

                    $('#btnBack').click(function (e) {
                        redirectUser("OrderList.htm?userID=" + userID);
                        e.preventDefault();
                    });
                    $('#tblArticleDetailsBody').delegate("#ddlItemID", "change", function () {
                        var selectedRow = $(this).closest('tr');
                        $(selectedRow).find("#txtItemDescription").val($(this).find("option:selected").text());
                    });
                    $("#btnClose").click(function (e) {
                        redirectUser("OrderList.htm?userID=" + userID);
                        e.preventDefault();
                    });
                    $("#btnSave").click(function (e) {
                        debugger;
                        //orderDetails = new Object();
                        orderDetails.itemsList = [];
                        //TODO Set Buyer and Seller
                        orderDetails.purchaseOrderNum = $("#txtPurchaseOrder").val();
                        orderDetails.totalPrice = $("#txtTotalPrice").val();
                        debugger;
                        //orderDetails.currency = $("#txtCurrency").val();
                        orderDetails.currency = $("#ddlCurrency").val();
                        orderDetails.deliveryDate = $("#txtDeliveryDate").val();
                        orderDetails.incoterm = $("#txtIncoterm").val();
                        orderDetails.pymntCondDays = $("#txtPaymentCondition").val();
                        // Set Party
                        //orderDetails.buyer= new Object();
                        //orderDetails.seller= new Object();
                        if (currentParty == party.buyer) // TODO: assign seller from drop down.
                        {
                            orderDetails.buyer.userName = userID;
                            orderDetails.buyer.name = userID;
                            if ($("#txtSearchBuyer").val().length > 0) {
                                orderDetails.seller.userName = $("#txtSearchBuyer").val();
                                orderDetails.seller.name = $("#txtSearchBuyer").val();
                            }
                        }
                        else {
                            orderDetails.seller.userName = userID;
                            orderDetails.seller.name = userID;
                            if ($("#txtSearchBuyer").val().length > 0) {
                                orderDetails.buyer.userName = $("#txtSearchBuyer").val();
                                orderDetails.buyer.name = $("#txtSearchBuyer").val();
                            }
                        }
                        //setArticleDetails
                        var tempItem = null;
                        $('#tblArticleDetails > tbody  > tr').each(function (index, tr) {
                            tempItem = {
                                article: {
                                    articleId: "widget",
                                    description: "widget",
                                    price: "3"
                                },
                                quantity: "0"
                            };
                            tempItem.article.articleId = $(tr).find("select option:selected").text();
                            tempItem.article.description = $('td:eq(1)', this).find("input:text").val();
                            tempItem.quantity = $('td:eq(2)', this).find("input:text").val();
                            tempItem.article.price = $('td:eq(2)', this).find("input:text").val();
                            orderDetails.itemsList.push(tempItem);
                        });
                        orderDetails.deliveryAddress = new Object();
                        orderDetails.deliveryAddress.streetName = $("#txtAddress").val();
                        //orderDetails.deliveryAddress.streetNumber = $("#txtAddress2").val();
                        orderDetails.deliveryAddress.streetNumber = "";
                        orderDetails.deliveryAddress.postalCode = $("#txtPostalCode").val();
                        orderDetails.deliveryAddress.city = $("#txtCity").val();
                        orderDetails.deliveryAddress.country = $("#txtCountry").val();

                        orderDetails.pymntConfirmation = $('#chkPaymentConfirmation').is(":checked");
                        orderDetails.bankPymntCommitment = $('#chkBankPaymentCommitment').is(":checked");
                        orderDetails.infoCounterparty = $('#chkInformationCounterparty').is(":checked");
                        orderDetails.forfaitingOfInvoice = $('#chkForfaitingOfInvoice').is(":checked");

                        var ltr = JSON.stringify(orderDetails);
                        //ltr= ltr.substring(1,ltr.length - 1) ;
                        $.ajax({
                            type: "PUT",
                            url: "http://localhost:10005/api/dtc/NodeB/create-purchase-order",
                            dataType: "json",
                            contentType: "application/json;charset=UTF-8",
                            data: ltr, //objOrder will be parameter name in service.
                            beforeSend: function () {
                                $("#divBusyStatus").show();
                            },
                            complete: function () {
                                $("#divBusyStatus").hide();
                            },
                            success: function (data) {
                                alert('Success');
                                window.location = "OrderList.htm?userID=" + userID;
                            },
                            error: function (errMsg) {
                                debugger;
                                //alert(errMsg);
                                //redirectUser("OrderList.htm?userID=" + userID);
                                window.location = "OrderList.htm?userID=" + userID;
                            }

                        });
                        //redirectUser("OrderList.htm?userID=" + currentUser.userID);
                        e.preventDefault();
                    });
                    $("#btnBuyer").click(function (e) {
                        currentParty = party.buyer;
                        $("#h4BuyerSeller").html("I am a " + currentParty);
                        $("#txtSearchBuyer").attr("placeholder", "Search " + party.seller);
                        //$("#txtPaymentCondition").attr("disabled", "disabled");
                        //$("#divBuyerExtraServices input[type='checkbox']").attr("disabled", "disabled");
                        //$("#divSellerExtraServices input[type='checkbox']").attr("disabled", false);
                        e.preventDefault();
                    });
                    $("#btnConfirmOrder").click(function (e) {
                        //TODO: confirm order.
                        redirectUser("OrderList.htm?userID=" + userID);
                        e.preventDefault();
                    });
                    $("#btnDeclineOrder").click(function (e) {
                        //TODO: confirm order.
                        redirectUser("OrderList.htm?userID=" + userID);
                        e.preventDefault();
                    });
                    $("#btnSendInvoice").click(function (e) {
                        //TODO: confirm order.
                        redirectUser("OrderList.htm?userID=" + userID);
                        e.preventDefault();
                    });
                    $("#btnSeller").click(function (e) {
                        currentParty = party.seller;
                        $("#h4BuyerSeller").html("I am a " + currentParty);
                        $("#txtSearchBuyer").attr("placeholder", "Search " + party.buyer);
                        //$("#txtPaymentCondition").attr("disabled", false);
                        //$("#divSellerExtraServices input[type='checkbox']").attr("disabled", "disabled");
                        //$("#divBuyerExtraServices input[type='checkbox']").attr("disabled", false);
                        e.preventDefault();
                    });
                    $("#divBusyStatus").hide();
                });
            </SCRIPT>
        </DIV>
    </FORM>
    <SCRIPT src="js/bootstrap.min.js"></SCRIPT>
</BODY>
</HTML>
